<!DOCTYPE html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet">
  <link rel="stylesheet" href="../styles/css/styles.css"></head>
<body>
  <script src="//d3js.org/d3.v3.min.js"></script>
  <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script>
  
  //set size
  var width = 300,
      height = 300,
      radius = Math.min(width, height) / 2;

  //set the colors
  var color = d3.scale.ordinal()
      .range(["#7bff88", "#98abc5", "#fa89a6", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

  //set the tooltip
  var tip = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-10, 0])
    .html(function(d) {
      return "<strong>" + d.data.age +":</strong> <span>" + d.data.population  + "</span>";
    })
    

  //set size of outer arc
  var arc = d3.svg.arc()
      .outerRadius(radius - 10)
      .innerRadius(radius - 70);

  var pie = d3.layout.pie()
      .sort(null)
      .value(function(d) { return d.population; });

  //draw the pie 
  var svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height)
      .append("g")
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

  //Draw the inner Circle
  svg.append("circle")
    .attr("cx", 0)
    .attr("cy", 0)
    .attr("r", 85)
    .attr("fill", "white");

  //initialize tool tip
  svg.call(tip);

  //plot data
  d3.csv("data.csv", type, function(error, data) {
    if (error) throw error;

  //sum for center text
  var sum =0;
    data.forEach(function(d) {
      sum += +d.population;
  });

  //add hover tooltip
  var g = svg.selectAll(".arc")
    .data(pie(data))
    .enter().append("g")
    .attr("class", "arc")
    .on('mouseover', tip.show)
    .on('mouseout', tip.hide)
    ;

  //hover circle
  var arcOver = d3.svg.arc()
    .innerRadius(radius-70)
    .outerRadius(150 + 0);

  //plot the data and create the hover transitions
  g.append("path")
    .attr("d", arc)
    .style("fill", function(d) { return color(d.data.age); })
    .on("mouseover", function(d) {
      d3.select(this).transition()
        .duration(1000)
        .attr("d", arcOver);
    })

    .on("mouseout", function(d) {
      d3.select(this).transition()
        .duration(1000)
        .attr("d", arc);
    })
  ;

  //set text for inner circle
  svg.append("text")
    .attr("dy", "0em")
    .style("text-anchor", "middle")
    .attr("class", "inside")
    .text(function() { return 'TOTAL'; });
  svg.append("text")
    .attr("dy", "1.5em")
    .style("text-anchor", "middle")
    .attr("class", "data")
    .text(function() { return sum;  });
  
  }); //end d3 read

  //return data as number
  function type(d) {
    d.population = +d.population;
    return d;
  }

</script>